(()=>{"use strict";const t={};function e(t,e){return(e||document).querySelector(t)}function i(t,e,i,s){t.addEventListener(e,i,!!s)}function s(t,e,s,o,l){i(t,s,(i=>{const s=i.target,l=t.querySelectorAll(e);let d=l.length;for(;d--;)if(l[d]===s){o.call(s,i);break}}),!!l)}const o=t=>parseInt(t.parentNode.dataset.id||t.parentNode.parentNode.dataset.id,10),l=new class{constructor(t,e){const{localStorage:i}=window;let s;this.getLocalStorage=()=>s||JSON.parse(i.getItem(t)||"[]"),this.setLocalStorage=e=>{i.setItem(t,JSON.stringify(s=e))},e&&e()}find(t,e){let i;e(this.getLocalStorage().filter((e=>{for(i in t)if(t[i]!==e[i])return!1;return!0})))}update(t,e){const{id:i}=t,s=this.getLocalStorage();let o,l=s.length;for(;l--;)if(s[l].id===i){for(o in t)s[l][o]=t[o];break}this.setLocalStorage(s),e&&e()}insert(t,e){const i=this.getLocalStorage();i.push(t),this.setLocalStorage(i),e&&e()}remove(t,e){let i;const s=this.getLocalStorage().filter((e=>{for(i in t)if(t[i]!==e[i])return!0;return!1}));this.setLocalStorage(s),e&&e(s)}count(e){this.find(t,(t=>{const i=t.length;let s=i,o=0;for(;s--;)o+=t[s].completed;e(i,i-o,o)}))}}("weekly-todos"),d=new class{itemList(t){let e="",i=0;return t.sort(((t,e)=>t.color>e.color?1:-1)).forEach((t=>{let s="";const o=new Date(t.date).getDay();var l;i!==o&&(s=`<time>${new Intl.DateTimeFormat("en-US",{dateStyle:"full"}).format(new Date(t.date))}</time>`,i=o),e+=`<li>${s}</li>`,e+=`<li data-id="${t.id}"${t.completed?' class="completed"':""}>\n        <div class="view">\n          <input class="toggle" type="checkbox" ${t.completed?"checked":""}>\n          <label>${l=t.title,l.replace(/[&<]/g,(t=>"&"===t?"&amp;":"&lt;"))}</label>\n          <button class="destroy"></button>\n        </div>\n      </li>`})),e}itemCounter(t){return`${t} item${1!==t?"s":""} left`}},n=new class{constructor(t){this.template=t,this.$todoList=e(".todo-list"),this.$todoItemCounter=e(".todo-count"),this.$clearCompleted=e(".clear-completed"),this.$main=e(".main"),this.$newTodo=e(".new-todo"),s(this.$todoList,"li label","dblclick",(({target:t})=>{this.editItem(t)}))}editItem(t){const e=t.parentElement.parentElement;e.classList.add("editing");const i=document.createElement("input");i.className="edit",i.value=t.innerText,e.appendChild(i),i.focus()}showItems(t){this.$todoList.innerHTML=this.template.itemList(t)}removeItem(t){const i=e(`[data-id="${t}"]`);i&&this.$todoList.removeChild(i)}setItemsLeft(t){this.$todoItemCounter.innerHTML=this.template.itemCounter(t)}setClearCompletedButtonVisibility(t){this.$clearCompleted.style.display=t?"block":"none"}setMainVisibility(t){this.$main.style.display=t?"block":"none"}updateFilterButtons(t){e(".filters .selected").className="",e(`.filters [href="#/${t}"]`).className="selected"}clearNewTodo(){this.$newTodo.value=""}setItemComplete(t,i){const s=e(`[data-id="${t}"]`);s&&(s.className=i?"completed":"",e("input",s).checked=i)}editItemDone(t,i){const s=e(`[data-id="${t}"]`),o=e("input.edit",s);s.removeChild(o),s.classList.remove("editing"),e("label",s).textContent=i}bindAddItem(t){i(this.$newTodo,"change",(({target:e})=>{const i=e.value.trim();i&&t(i)}))}bindRemoveCompleted(t){i(this.$clearCompleted,"click",t)}bindRemoveItem(t){s(this.$todoList,".destroy","click",(({target:e})=>{t(o(e))}))}bindToggleItem(t){s(this.$todoList,".toggle","click",(({target:e})=>{t(o(e),e.checked)}))}bindEditItemSave(t){s(this.$todoList,"li .edit","blur",(({target:e})=>{e.dataset.iscanceled||t(o(e),e.value.trim())}),!0),s(this.$todoList,"li .edit","keypress",(({target:t,keyCode:e})=>{13===e&&t.blur()}))}bindEditItemCancel(t){s(this.$todoList,"li .edit","keyup",(({target:e,keyCode:i})=>{27===i&&(e.dataset.iscanceled=!0,e.blur(),t(o(e)))}))}}(d),a=new class{constructor(t,e){this.store=t,this.view=e,e.bindAddItem(this.addItem.bind(this)),e.bindEditItemSave(this.editItemSave.bind(this)),e.bindEditItemCancel(this.editItemCancel.bind(this)),e.bindRemoveItem(this.removeItem.bind(this)),e.bindToggleItem(((t,e)=>{this.toggleCompleted(t,e),this._filter()})),e.bindRemoveCompleted(this.removeCompletedItems.bind(this)),this._activeRoute="",this._lastActiveRoute=null}setView(t){const e=t.replace(/^#\//,"");this._activeRoute=e,this._filter(),this.view.updateFilterButtons(e)}addItem(t){this.store.insert({id:Date.now(),title:t,date:Date.now(),completed:!1},(()=>{this.view.clearNewTodo(),this._filter(!0)}))}editItemSave(t,e){e.length?this.store.update({id:t,title:e},(()=>{this.view.editItemDone(t,e)})):this.removeItem(t)}editItemCancel(t){this.store.find({id:t},(e=>{const{title:i}=e[0];this.view.editItemDone(t,i)}))}removeItem(t){this.store.remove({id:t},(()=>{this._filter(),this.view.removeItem(t)}))}removeCompletedItems(){this.store.remove({completed:!0},this._filter.bind(this))}toggleCompleted(t,e){this.store.update({id:t,completed:e},(()=>{this.view.setItemComplete(t,e)}))}toggleAll(t){this.store.find({completed:!t},(e=>{for(const{id:i}of e)this.toggleCompleted(i,t)})),this._filter()}_filter(e){const i=this._activeRoute;(e||""!==this._lastActiveRoute||this._lastActiveRoute!==i)&&this.store.find({"":t,active:{completed:!1},completed:{completed:!0}}[i],this.view.showItems.bind(this.view)),this.store.count(((t,e,i)=>{this.view.setItemsLeft(e),this.view.setClearCompletedButtonVisibility(i),this.view.setMainVisibility(t)})),this._lastActiveRoute=i}}(l,n),r=()=>a.setView(document.location.hash);i(window,"load",r),i(window,"hashchange",r)})();